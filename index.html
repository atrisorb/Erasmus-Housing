<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitleHome">Erasmus Housing - Trova il tuo alloggio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-bg {
            background-image: url('/images/sfondo_home_page_ragazzi_edifici.png'); /* Assicurati che il percorso sia corretto */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .search-bar-container { background-color: rgba(255, 255, 255, 0.92); backdrop-filter: blur(8px); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        #mobileMenu { transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out; max-height: 0; opacity:0; overflow: hidden; }
        #mobileMenu.open { max-height: 500px; opacity: 1; }
        .language-switcher button { padding: 0.25rem 0.5rem; margin-left: 0.25rem; border-radius: 0.25rem; border: 1px solid transparent;}
        .language-switcher button.active { background-color: #4f46e5; color: white; border-color: #4f46e5;}
        .language-switcher button:not(.active):hover { background-color: #e0e7ff; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold text-indigo-600 mr-2 sm:mr-4">ErasmusHousing</a>
                <div class="language-switcher text-xs flex">
                    <button id="lang-it" data-lang="it" class="border-gray-300">IT</button>
                    <button id="lang-en" data-lang="en" class="border-gray-300">EN</button>
                </div>
            </div>
            <div class="md:hidden">
                <button id="mobileMenuButton" aria-label="Apri menu" class="text-gray-700 focus:outline-none">
                    <svg id="menuIconOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    <svg id="menuIconClose" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="navLinksDesktop" class="hidden md:flex space-x-3 lg:space-x-4 items-center text-sm lg:text-base">
                <a href="index.html" data-translate-key="navHome" class="text-indigo-600 font-semibold px-2 py-1">Home</a>
                <a href="listings.html" data-translate-key="navListings" class="text-gray-600 hover:text-indigo-600 px-2 py-1">Annunci</a>
                <a href="messages.html" id="navMessagesLinkDesktop" data-translate-key="navMessages" class="text-gray-600 hover:text-indigo-600 px-2 py-1 hidden">Messaggi</a>
                <a href="add-listing.html" id="navAddListingLinkDesktop" data-translate-key="navAddListing" class="text-gray-600 hover:text-indigo-600 px-2 py-1">Pubblica Annuncio</a>
                <a href="login.html" id="navLoginLinkDesktop" data-translate-key="navLogin" class="bg-indigo-600 text-white px-3 py-1.5 rounded-md hover:bg-indigo-700 text-sm">Login</a>
                <div id="navUserProfileDesktop" class="hidden inline-flex items-center">
                    <img id="navUserPicDesktop" src="https://placehold.co/40x40/A0AEC0/FFFFFF?text=U" alt="User" class="w-8 h-8 rounded-full mr-2 hidden object-cover">
                    <span id="navUserNameDesktop" class="text-gray-700 mr-2 text-sm font-medium"></span>
                    <button id="navLogoutBtnDesktop" data-translate-key="navLogout" class="bg-red-500 text-white px-2.5 py-1 rounded-md hover:bg-red-600 text-xs">Logout</button>
                </div>
            </div>
        </nav>
        <div id="mobileMenu" class="md:hidden bg-white shadow-lg absolute top-full left-0 right-0 z-30">
            <a href="index.html" data-translate-key="navHome" class="block px-4 py-3 text-indigo-500 font-semibold bg-indigo-50 border-b border-gray-100">Home</a>
            <a href="listings.html" data-translate-key="navListings" class="block px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100">Annunci</a>
            <a href="messages.html" id="navMessagesLinkMobile" data-translate-key="navMessages" class="block px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100 hidden">Messaggi</a>
            <a href="add-listing.html" id="navAddListingLinkMobile" data-translate-key="navAddListing" class="block px-4 py-3 text-gray-700 hover:bg-indigo-50 border-b border-gray-100">Pubblica Annuncio</a>
            <div class="px-4 py-3 mt-2 border-t border-gray-200">
                <a href="login.html" id="navLoginLinkMobile" data-translate-key="navLogin" class="block text-center w-full bg-indigo-600 text-white px-4 py-2.5 rounded-md hover:bg-indigo-700 mb-2">Login</a>
                <div id="navUserProfileMobile" class="hidden text-center">
                    <img id="navUserPicMobile" src="https://placehold.co/40x40/A0AEC0/FFFFFF?text=U" alt="User" class="w-10 h-10 rounded-full mx-auto mb-2 hidden object-cover">
                    <span id="navUserNameMobile" class="block text-gray-700 mb-2 font-medium"></span>
                    <button id="navLogoutBtnMobile" data-translate-key="navLogout" class="w-full bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <section class="hero-bg h-[calc(100vh-60px)] md:h-[calc(100vh-68px)] flex items-center justify-center text-white px-4">
        <div class="text-center bg-black bg-opacity-60 p-6 sm:p-10 rounded-lg">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-3 sm:mb-4" data-translate-key="heroTitle">Trova l'alloggio ideale per il tuo Erasmus</h1>
            <p class="text-lg sm:text-xl mb-6 sm:mb-8" data-translate-key="heroSubtitle">Ricerca alloggi per studenti in tutta Europa.</p>
            <div class="search-bar-container max-w-2xl mx-auto p-4 sm:p-6 rounded-lg shadow-xl">
                <form class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end" action="listings.html" method="GET">
                    <div>
                        <label for="city" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="searchCityLabel">Citt√† / Nazione</label>
                        <input type="text" id="city" name="city" data-translate-key="searchCityPlaceholder" placeholder="Es. Parigi, Francia" class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-sm">
                    </div>
                    <div>
                        <label for="type" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="searchTypeLabel">Tipo di alloggio</label>
                        <select id="type" name="type" class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-sm">
                            <option value="" data-translate-key="searchTypeAny">Qualsiasi</option>
                            <option value="stanza_singola" data-translate-key="searchTypeSingleRoom">Stanza Singola</option>
                            <option value="stanza_doppia" data-translate-key="searchTypeDoubleRoom">Stanza Doppia</option>
                            <option value="monolocale" data-translate-key="searchTypeStudio">Monolocale</option>
                            <option value="appartamento" data-translate-key="searchTypeApartment">Appartamento</option>
                            <option value="residenza_studentesca" data-translate-key="searchTypeResidence">Residenza Studentesca</option>
                        </select>
                    </div>
                    <button type="submit" class="md:col-span-1 bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition duration-150 w-full text-sm font-semibold" data-translate-key="searchButton">
                        Cerca
                    </button>
                </form>
            </div>
        </div>
    </section>

    <section class="py-12 md:py-16 bg-white">
        <div class="container mx-auto px-4 sm:px-6">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-8 md:mb-12 text-gray-800" data-translate-key="featuredListingsTitle">Annunci in primo piano</h2>
            <div id="featuredListingsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <div class="bg-gray-50 rounded-lg shadow-lg overflow-hidden card-hover transition-all duration-300">
                    <img src="https://placehold.co/600x400/E2E8F0/A0AEC0?text=Alloggio+1" alt="Immagine alloggio 1" class="w-full h-48 sm:h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Immagine+Non+Disponibile';">
                    <div class="p-4 sm:p-6"><h3 class="text-lg sm:text-xl font-semibold mb-2 text-indigo-700">Stanza singola - Madrid</h3><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Tipo:</span> Stanza Singola</p><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Prezzo:</span> ‚Ç¨450/mese</p><p class="text-sm text-gray-700 mb-3 sm:mb-4 line-clamp-3">Bellissima stanza singola in appartamento condiviso...</p><a href="listing-detail.html?id=1" class="inline-block bg-indigo-500 text-white text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 rounded-md hover:bg-indigo-600" data-translate-key="viewDetailsButton">Vedi Dettagli</a></div>
                </div>
                <div class="bg-gray-50 rounded-lg shadow-lg overflow-hidden card-hover transition-all duration-300">
                    <img src="https://placehold.co/600x400/CBD5E0/A0AEC0?text=Alloggio+2" alt="Immagine alloggio 2" class="w-full h-48 sm:h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Immagine+Non+Disponibile';">
                    <div class="p-4 sm:p-6"><h3 class="text-lg sm:text-xl font-semibold mb-2 text-indigo-700">Monolocale - Berlino</h3><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Tipo:</span> Monolocale</p><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Prezzo:</span> ‚Ç¨600/mese</p><p class="text-sm text-gray-700 mb-3 sm:mb-4 line-clamp-3">Monolocale arredato con gusto nel cuore di Berlino...</p><a href="listing-detail.html?id=2" class="inline-block bg-indigo-500 text-white text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 rounded-md hover:bg-indigo-600" data-translate-key="viewDetailsButton">Vedi Dettagli</a></div>
                </div>
                <div class="bg-gray-50 rounded-lg shadow-lg overflow-hidden card-hover transition-all duration-300">
                     <img src="https://placehold.co/600x400/BEE3F8/A0AEC0?text=Alloggio+3" alt="Immagine alloggio 3" class="w-full h-48 sm:h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Immagine+Non+Disponibile';">
                    <div class="p-4 sm:p-6"><h3 class="text-lg sm:text-xl font-semibold mb-2 text-indigo-700">Posto in doppia - Parigi</h3><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Tipo:</span> Stanza Doppia</p><p class="text-xs sm:text-sm text-gray-600 mb-1"><span class="font-medium">Prezzo:</span> ‚Ç¨380/mese</p><p class="text-sm text-gray-700 mb-3 sm:mb-4 line-clamp-3">Posto letto in stanza doppia, Quartiere Latino...</p><a href="listing-detail.html?id=3" class="inline-block bg-indigo-500 text-white text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 rounded-md hover:bg-indigo-600" data-translate-key="viewDetailsButton">Vedi Dettagli</a></div>
                </div>
            </div>
            <div class="text-center mt-10 md:mt-12"><a href="listings.html" class="bg-green-500 text-white px-6 py-2.5 sm:px-8 sm:py-3 rounded-md hover:bg-green-600 text-base sm:text-lg font-semibold" data-translate-key="seeAllListingsButton">Vedi tutti gli annunci</a></div>
        </div>
    </section>
    
    <section class="py-12 md:py-16 bg-gray-100">
        <div class="container mx-auto px-4 sm:px-6">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-8 md:mb-12 text-gray-800" data-translate-key="howItWorksTitle">Come funziona</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 text-center">
                <div class="p-6 bg-white rounded-lg shadow-md"><div class="text-indigo-600 mb-4"><svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div><h3 class="text-lg sm:text-xl font-semibold mb-2" data-translate-key="howItWorksStep1Title">1. Cerca</h3><p class="text-sm sm:text-base text-gray-600" data-translate-key="howItWorksStep1Text">Inserisci destinazione e preferenze.</p></div>
                <div class="p-6 bg-white rounded-lg shadow-md"><div class="text-indigo-600 mb-4"><svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg></div><h3 class="text-lg sm:text-xl font-semibold mb-2" data-translate-key="howItWorksStep2Title">2. Contatta</h3><p class="text-sm sm:text-base text-gray-600" data-translate-key="howItWorksStep2Text">Parla con proprietari o residenze.</p></div>
                <div class="p-6 bg-white rounded-lg shadow-md"><div class="text-indigo-600 mb-4"><svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg></div><h3 class="text-lg sm:text-xl font-semibold mb-2" data-translate-key="howItWorksStep3Title">3. Prenota</h3><p class="text-sm sm:text-base text-gray-600" data-translate-key="howItWorksStep3Text">Assicurati il tuo alloggio Erasmus.</p></div>
            </div>
        </div>
    </section>

    <section class="py-12 md:py-16 bg-indigo-600 text-white">
        <div class="container mx-auto px-4 sm:px-6 text-center">
            <h2 class="text-2xl sm:text-3xl font-bold mb-3 sm:mb-4" data-translate-key="ctaTitle">Hai un alloggio da affittare a studenti?</h2>
            <p class="text-base sm:text-lg mb-6 sm:mb-8" data-translate-key="ctaSubtitle">Raggiungi migliaia di studenti. Pubblica il tuo annuncio gratuitamente!</p>
            <a href="add-listing.html" id="ctaAddListingLink" class="bg-white text-indigo-600 px-6 py-2.5 sm:px-8 sm:py-3 rounded-md hover:bg-gray-100 text-base sm:text-lg font-semibold" data-translate-key="ctaButton">Pubblica il tuo annuncio</a>
        </div>
    </section>

    <footer id="contact" class="bg-gray-800 text-white py-10 md:py-12">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div><h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4" data-translate-key="footerErasmusHousing">ErasmusHousing</h3><p class="text-sm text-gray-400" data-translate-key="footerDescription">La tua piattaforma per alloggi Erasmus.</p></div>
                <div><h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4" data-translate-key="footerUsefulLinks">Link Utili</h3><ul class="space-y-1.5 sm:space-y-2"><li class="text-sm"><a href="#" data-translate-key="footerAboutUs" class="text-gray-400 hover:text-white">Chi Siamo</a></li><li class="text-sm"><a href="listings.html" data-translate-key="footerSearchListings" class="text-gray-400 hover:text-white">Cerca Annunci</a></li><li class="text-sm"><a href="add-listing.html" id="footerAddListingLink" data-translate-key="footerAddListing" class="text-gray-400 hover:text-white">Pubblica Annuncio</a></li></ul></div>
                <div>
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4" data-translate-key="footerContactUs">Contattaci</h3>
                    <p class="text-sm text-gray-400">Email: info@erasmus-housing.com</p>
                    <div class="flex space-x-4 mt-4 justify-center md:justify-start">
                        <a href="https://www.instagram.com/erasmushousing/?utm_source=ig_web_button_share_sheet" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white" aria-label="Instagram">
                            <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"> {/* Nota: rimosso fill="currentColor" e viewBox modificato se necessario */}
                                <defs>
                                    <radialGradient id="instaGradient" gradientUnits="userSpaceOnUse" cx="19.38" cy="42.035" r="44.899">
                                        <stop offset="0" stop-color="#fd5"/>
                                        <stop offset=".328" stop-color="#ff543f"/>
                                        <stop offset=".348" stop-color="#fc5245"/>
                                        <stop offset=".504" stop-color="#e64771"/>
                                        <stop offset=".643" stop-color="#d53e91"/>
                                        <stop offset=".761" stop-color="#cc39a4"/>
                                        <stop offset=".841" stop-color="#c837ab"/>
                                    </radialGradient>
                                </defs>
                                <path fill="url(#instaGradient)" d="M34.017,41.99l-20,0.019c-4.4,0.004-8.003-3.592-8.008-7.992l-0.019-20	c-0.004-4.4,3.592-8.003,7.992-8.008l20-0.019c4.4-0.004,8.003,3.592,8.008,7.992l0.019,20	C42.014,38.383,38.417,41.986,34.017,41.99z"/>
                                <path fill="#fff" d="M24,31c-3.859,0-7-3.141-7-7s3.141-7,7-7s7,3.141,7,7S27.859,31,24,31z M24,19c-2.757,0-5,2.243-5,5	s2.243,5,5,5s5-2.243,5-5S26.757,19,24,19z"/>
                                <circle cx="31.5" cy="16.5" r="1.5" fill="#fff"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 text-center text-gray-500 text-sm"><p>&copy; <span id="currentYear"></span> ErasmusHousing. <span data-translate-key="footerAllRightsReserved">Tutti i diritti riservati.</span></p></div>
        </div>
    </footer>

    <script>
        // IMPORTANTE: Sostituisci 'IL_TUO_URL_RENDER_QUI' con l'URL effettivo del tuo servizio Render.
        const API_BASE_URL = 'https://erasmushousing.onrender.com'; 
        
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        const navLoginLinkDesktop = document.getElementById('navLoginLinkDesktop');
        const navUserProfileDesktop = document.getElementById('navUserProfileDesktop');
        const navUserNameDesktop = document.getElementById('navUserNameDesktop');
        const navUserPicDesktop = document.getElementById('navUserPicDesktop');
        const navLogoutBtnDesktop = document.getElementById('navLogoutBtnDesktop');
        const navMessagesLinkDesktop = document.getElementById('navMessagesLinkDesktop');
        const navAddListingLinkDesktop = document.getElementById('navAddListingLinkDesktop');

        const navLoginLinkMobile = document.getElementById('navLoginLinkMobile');
        const navUserProfileMobile = document.getElementById('navUserProfileMobile');
        const navUserNameMobile = document.getElementById('navUserNameMobile');
        const navUserPicMobile = document.getElementById('navUserPicMobile');
        const navLogoutBtnMobile = document.getElementById('navLogoutBtnMobile');
        const navMessagesLinkMobile = document.getElementById('navMessagesLinkMobile');
        const navAddListingLinkMobile = document.getElementById('navAddListingLinkMobile');
        
        const ctaAddListingLink = document.getElementById('ctaAddListingLink'); 
        const footerAddListingLink = document.getElementById('footerAddListingLink'); 

        const translations = {
            it: {
                pageTitleHome: "Erasmus Housing - Trova il tuo alloggio",
                navHome: "Home", navListings: "Annunci", navMessages: "Messaggi", navAddListing: "Pubblica Annuncio", navContact: "Contatti", navLogin: "Login", navLogout: "Logout",
                heroTitle: "Trova l'alloggio ideale per il tuo Erasmus", heroSubtitle: "Ricerca alloggi per studenti in tutta Europa.",
                searchCityLabel: "Citt√† / Nazione", searchCityPlaceholder: "Es. Parigi, Francia", searchTypeLabel: "Tipo di alloggio", searchTypeAny: "Qualsiasi", searchTypeSingleRoom: "Stanza Singola", searchTypeDoubleRoom: "Stanza Doppia", searchTypeStudio: "Monolocale", searchTypeApartment: "Appartamento", searchTypeResidence: "Residenza Studentesca", searchButton: "Cerca",
                featuredListingsTitle: "Annunci in primo piano", viewDetailsButton: "Vedi Dettagli", seeAllListingsButton: "Vedi tutti gli annunci",
                howItWorksTitle: "Come funziona", howItWorksStep1Title: "1. Cerca", howItWorksStep1Text: "Inserisci destinazione e preferenze.", howItWorksStep2Title: "2. Contatta", howItWorksStep2Text: "Parla con proprietari o residenze.", howItWorksStep3Title: "3. Prenota", howItWorksStep3Text: "Assicurati il tuo alloggio Erasmus.",
                ctaTitle: "Hai un alloggio da affittare a studenti?", ctaSubtitle: "Raggiungi migliaia di studenti. Pubblica il tuo annuncio gratuitamente!", ctaButton: "Pubblica il tuo annuncio",
                footerErasmusHousing: "ErasmusHousing", footerDescription: "La tua piattaforma per alloggi Erasmus.", footerUsefulLinks: "Link Utili", footerAboutUs: "Chi Siamo", footerSearchListings: "Cerca Annunci", footerAddListing: "Pubblica Annuncio", footerContactUs: "Contattaci", footerContactUsInline: "Contatti", footerAllRightsReserved: "Tutti i diritti riservati."
            },
            en: {
                pageTitleHome: "Erasmus Housing - Find Your Accommodation",
                navHome: "Home", navListings: "Listings", navMessages: "Messages", navAddListing: "Post Ad", navContact: "Contact", navLogin: "Login", navLogout: "Logout",
                heroTitle: "Find Your Ideal Erasmus Accommodation", heroSubtitle: "Search for student housing across Europe.",
                searchCityLabel: "City / Country", searchCityPlaceholder: "E.g. Paris, France", searchTypeLabel: "Housing Type", searchTypeAny: "Any", searchTypeSingleRoom: "Single Room", searchTypeDoubleRoom: "Double Room", searchTypeStudio: "Studio", searchTypeApartment: "Apartment", searchTypeResidence: "Student Residence", searchButton: "Search",
                featuredListingsTitle: "Featured Listings", viewDetailsButton: "View Details", seeAllListingsButton: "See All Listings",
                howItWorksTitle: "How it Works", howItWorksStep1Title: "1. Search", howItWorksStep1Text: "Enter destination and preferences.", howItWorksStep2Title: "2. Contact", howItWorksStep2Text: "Talk to landlords or residences.", howItWorksStep3Title: "3. Book", howItWorksStep3Text: "Secure your Erasmus accommodation.",
                ctaTitle: "Have a place to rent to students?", ctaSubtitle: "Reach thousands of students. Post your ad for free!", ctaButton: "Post Your Ad",
                footerErasmusHousing: "ErasmusHousing", footerDescription: "Your platform for Erasmus housing.", footerUsefulLinks: "Useful Links", footerAboutUs: "About Us", footerSearchListings: "Search Listings", footerAddListing: "Post Ad", footerContactUs: "Contact Us", footerContactUsInline: "Contact", footerAllRightsReserved: "All rights reserved."
            }
        };

        function setLanguage(lang) {
            localStorage.setItem('erasmusHousingLang', lang);
            document.documentElement.lang = lang; 
            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.placeholder) { element.placeholder = translations[lang][key]; }
                    else if (element.tagName === 'TITLE') { document.title = translations[lang][key]; }
                    else { element.textContent = translations[lang][key]; }
                }
            });
            const langItButton = document.getElementById('lang-it');
            const langEnButton = document.getElementById('lang-en');
            if (langItButton) langItButton.classList.toggle('active', lang === 'it');
            if (langEnButton) langEnButton.classList.toggle('active', lang === 'en');
        }
        
        const langItButton = document.getElementById('lang-it');
        const langEnButton = document.getElementById('lang-en');
        if (langItButton) langItButton.addEventListener('click', (e) => { e.preventDefault(); setLanguage('it'); });
        if (langEnButton) langEnButton.addEventListener('click', (e) => { e.preventDefault(); setLanguage('en'); });
        
        async function updateNavbarUI() {
            let isLoggedIn = false; let userData = null;
            if (API_BASE_URL === 'IL_TUO_URL_RENDER_QUI' && !window.location.href.startsWith('file://')) { console.warn("API_BASE_URL non configurato."); }
            else if (API_BASE_URL !== 'IL_TUO_URL_RENDER_QUI' || window.location.href.startsWith('file://')) {
                try { const response = await fetch(`${API_BASE_URL}/api/auth/status`); const data = await response.json(); if (data.logged_in && data.user) { isLoggedIn = true; userData = data.user; }}
                catch (error) { console.error("Errore fetch /api/auth/status:", error); }
            }

            const updateElements = (loginLink, userProfile, userName, userPic, messagesLink, addListingLink) => {
                if (loginLink) { isLoggedIn ? loginLink.classList.add('hidden') : loginLink.classList.remove('hidden'); }
                if (userProfile) { isLoggedIn ? userProfile.classList.remove('hidden') : userProfile.classList.add('hidden'); }
                if (isLoggedIn && userData) {
                    if (userName) userName.textContent = userData.name || userData.email;
                    if (userPic) { userPic.src = userData.profile_pic || 'https://placehold.co/40x40/A0AEC0/FFFFFF?text=U'; userPic.classList.remove('hidden');}
                    if (messagesLink) messagesLink.classList.remove('hidden');
                } else {
                    if (userPic) userPic.classList.add('hidden');
                    if (messagesLink) messagesLink.classList.add('hidden');
                }
                const addListingTargetUrl = 'add-listing.html'; const loginRedirectForAddListing = `login.html?redirect=${encodeURIComponent(addListingTargetUrl)}`;
                if (addListingLink) { addListingLink.href = isLoggedIn ? addListingTargetUrl : loginRedirectForAddListing; }
            };
            updateElements(navLoginLinkDesktop, navUserProfileDesktop, navUserNameDesktop, navUserPicDesktop, navMessagesLinkDesktop, navAddListingLinkDesktop);
            updateElements(navLoginLinkMobile, navUserProfileMobile, navUserNameMobile, navUserPicMobile, navMessagesLinkMobile, navAddListingLinkMobile);
            
            const addListingTargetUrl = 'add-listing.html';
            const loginRedirectForAddListing = `login.html?redirect=${encodeURIComponent(addListingTargetUrl)}`;
            const finalAddListingHref = isLoggedIn ? addListingTargetUrl : loginRedirectForAddListing;
            if(ctaAddListingLink) ctaAddListingLink.href = finalAddListingHref;
            if(footerAddListingLink) footerAddListingLink.href = finalAddListingHref;
        }
        
        function setupLogoutButtons() {
            const handleLogout = async () => {
                if (API_BASE_URL === 'IL_TUO_URL_RENDER_QUI' && !window.location.href.startsWith('file://')) { alert("Configurazione API non completata."); return; }
                try {
                    const response = await fetch(`${API_BASE_URL}/api/auth/logout`, { method: 'POST' });
                    if (response.ok) { 
                        await updateNavbarUI(); 
                        if (window.location.pathname.includes('messages.html') || window.location.pathname.includes('add-listing.html') || window.location.pathname.includes('listing-detail.html')) { window.location.href = 'index.html'; }
                        else if (window.location.pathname.includes('login.html')) {} 
                        else { /* Non serve reload su index/listings */ }
                    } else { const errorData = await response.json(); console.error("Logout fallito:", errorData.error || response.statusText); }
                } catch (error) { console.error("Errore durante il logout:", error); }
            };
            if (navLogoutBtnDesktop) navLogoutBtnDesktop.addEventListener('click', handleLogout);
            if (navLogoutBtnMobile) navLogoutBtnMobile.addEventListener('click', handleLogout);
        }
        
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuIconOpen = document.getElementById('menuIconOpen');
        const menuIconClose = document.getElementById('menuIconClose');

        if (mobileMenuButton && mobileMenu && menuIconOpen && menuIconClose) {
            mobileMenuButton.addEventListener('click', () => {
                const isOpen = mobileMenu.classList.contains('open');
                if (isOpen) {
                    mobileMenu.style.maxHeight = '0px';
                    mobileMenu.style.opacity = '0';
                    setTimeout(() => { if (mobileMenu.style.maxHeight === '0px') { mobileMenu.classList.add('hidden'); }}, 300); 
                    mobileMenu.classList.remove('open');
                    menuIconOpen.classList.remove('hidden');
                    menuIconClose.classList.add('hidden');
                } else {
                    mobileMenu.classList.remove('hidden');
                    void mobileMenu.offsetWidth; // Forza reflow
                    mobileMenu.style.maxHeight = '500px';
                    mobileMenu.style.opacity = '1';
                    mobileMenu.classList.add('open');
                    menuIconOpen.classList.add('hidden');
                    menuIconClose.classList.remove('hidden');
                }
            });
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (mobileMenu.classList.contains('open')) {
                        mobileMenu.style.maxHeight = '0px'; mobileMenu.style.opacity = '0';
                        setTimeout(() => mobileMenu.classList.add('hidden'), 300);
                        mobileMenu.classList.remove('open');
                        if(menuIconOpen) menuIconOpen.classList.remove('hidden');
                        if(menuIconClose) menuIconClose.classList.add('hidden');
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const preferredLang = localStorage.getItem('erasmusHousingLang') || 'it';
            if (mobileMenu && menuIconOpen && menuIconClose) {
                mobileMenu.classList.remove('open');
                mobileMenu.style.maxHeight = '0px';
                mobileMenu.style.opacity = '0';
                mobileMenu.classList.add('hidden'); 
                                            
                menuIconOpen.classList.remove('hidden');
                menuIconClose.classList.add('hidden');
            }
            setLanguage(preferredLang);
            updateNavbarUI();
            setupLogoutButtons();
        });
    </script>
</body>
</html>
